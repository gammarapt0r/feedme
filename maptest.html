<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Map Sample</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #panel {
        position: absolute;
        top: 5px;
        left: 50%;
        margin-left: -180px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
      }
    </style>
    <script type="text/javascript">

function geolocate(timezone, cityPrecision, objectVar) {
 
  var api = (cityPrecision) ? "ip-city" : "ip-country";
  var domain = 'api.ipinfodb.com';
  var url = "http://" + domain + "/v3/" + api + "/?key=<your_api_key>&format=json" + "&callback=" + objectVar + ".setGeoCookie";
  var geodata;
  var callbackFunc;
  var JSON = JSON || {};
 
  // implement JSON.stringify serialization
  JSON.stringify = JSON.stringify || function (obj) {
    var t = typeof (obj);
    if (t != "object" || obj === null) {
      // simple data type
      if (t == "string") obj = '"'+obj+'"';
        return String(obj);
    } else {
    // recurse array or object
      var n, v, json = [], arr = (obj && obj.constructor == Array);
      for (n in obj) {
        v = obj[n]; t = typeof(v);
        if (t == "string") v = '"'+v+'"';
        else if (t == "object" && v !== null) v = JSON.stringify(v);
        json.push((arr ? "" : '"' + n + '":') + String(v));
      }
      return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");
    }
  };
 
  // implement JSON.parse de-serialization
  JSON.parse = JSON.parse || function (str) {
    if (str === "") str = '""';
      eval("var p=" + str + ";");
      return p;
  };
 
  //Check if cookie already exist. If not, query IPInfoDB
  this.checkcookie = function(callback) {
    geolocationCookie = getCookie('geolocation');
    callbackFunc = callback;
    if (!geolocationCookie) {
      getGeolocation();
    } else {
      geodata = JSON.parse(geolocationCookie);
      callbackFunc();
    }
  }
 
  //API callback function that sets the cookie with the serialized JSON answer
  this.setGeoCookie = function(answer) {
    if (answer['statusCode'] == 'OK') {
      JSONString = JSON.stringify(answer);
      setCookie('geolocation', JSONString, 365);
      geodata = answer;
      callbackFunc();
    }
  }
 
  //Return a geolocation field
  this.getField = function(field) {
    try {
      return geodata[field];
    } catch(err) {}
  }
 
  //Request to IPInfoDB
  function getGeolocation() {
    try {
      script = document.createElement('script');
      script.src = url;
      document.body.appendChild(script);
    } catch(err) {}
  }
 
  //Set the cookie
  function setCookie(c_name, value, expire) {
    var exdate=new Date();
    exdate.setDate(exdate.getDate()+expire);
    document.cookie = c_name+ "=" +escape(value) + ((expire==null) ? "" : ";expires="+exdate.toGMTString());
  }
 
  //Get the cookie content
  function getCookie(c_name) {
    if (document.cookie.length > 0 ) {
      c_start=document.cookie.indexOf(c_name + "=");
      if (c_start != -1){
        c_start=c_start + c_name.length+1;
        c_end=document.cookie.indexOf(";",c_start);
        if (c_end == -1) {
          c_end=document.cookie.length;
        }
        return unescape(document.cookie.substring(c_start,c_end));
      }
    }
    return '';
  }
}
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVIv0OBgDPfJ2bN5GqE13HaA7u1d4j3_o&sensor=true"></script>
    
<script>
	var geocoder;
	var map;
	var markerlist = [];
	function initialize() {
		geocoder = new google.maps.Geocoder();
		var latlng = new google.maps.LatLng(53.5333, -113.5000);
		var mapOptions = {zoom: 11, center: latlng}
		map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
	}
	function displayAddressList() {
		 for (i = 0; i < markerlist.length; i++) {  
			
			markerlist[i][0].setMap(map);
			alert(markerlist[i][0].getPosition());
			google.maps.event.addListener(markerlist[i][0], 'click', 
			function() {
				alert('click' + i);
				var infowindow = new google.maps.InfoWindow();
				infowindow.setContent(markerlist[i][1]);
				infowindow.open(map,markerList[i][0]);
			}
			
			);
			infowindow.open(map,markerList[i][0])
			
		
		}
	}
	function codeAddress() {
		var address = document.getElementById('address').value;
		var info = document.getElementById('info').value;
		geocoder.geocode( { 'address': address}, function(results, status) {
  
		if (status == google.maps.GeocoderStatus.OK) {
			markerlist.push([(new google.maps.Marker({map: map, position: results[0].geometry.location})),info]);
			displayAddressList();
		} else {
			alert('Geocode was not successful for the following reason: ' + status);
		}
	
  });
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="panel">
      <input id="address" onfocus="if(this.value == 'Enter address here') { this.value = ''; }" type="textbox" value="Enter address here">
	  <input id="info" onfocus="if(this.value == 'Enter info here') { this.value = ''; }" type="textbox" value="Enter info here">
      <input type="button" value="Display" onclick="codeAddress()">
    </div>
    <div id="map-canvas"></div>
  </body>
</html>